## **十，跨站腳本攻擊**

>作者：Peter Yaworski
>
>譯者：飛龍
>
>協議：CC BY-NC-SA 4.0

## **描述**
跨站腳本，或者XSS，涉及到站定包含非預期的JavaScript腳本程式碼，它隨後傳給用於，用戶在瀏覽器中執行了該程式碼。它的一個無害示例為：

```javascript
alert('XSS');
```

這會調用JavaScript函數`alert`，並創建一個簡單的彈出窗口，帶有純文字`XSS`。現在，在這本書的前一個版本中，我推薦你在報告中使用這個例子。但是，一個非常成功的黑客告訴我這是個糟糕的例子，因為漏洞的接收者通常沒有意識到這個問題的嚴重性，並且可能由於無害的示例而得到較低的獎金。


所以，考慮到這種情況，使用示例開判斷XSS是否存在，但是報告時，考慮漏洞如何影響站點，並解釋它。通過這樣，我並不是告訴廠商什麼事XSS，而是解釋你可以使用它做什麼事，來影響他們的站點。

這應該包含識別你報告了何種XSS，它們包括：

- 反射型 XSS：這些攻擊並不是持久的，意思是 XSS 傳遞後通過簡單的請求和響應執行。
- 儲存型 XSS：這些攻擊是持久的，或已保存，之後在頁面加載時執行給無意識的用戶。
- Self XSS：這些攻擊也不是持久的，通常作為戲弄用戶的一部分，使它們自己執行 XSS。

當你搜索漏洞時，你會經常發現，廠商不關心 Self XSS，它們只關心，它們的用戶是否自身存在缺陷，就像反射和儲存 XSS 的例子那樣。但是，這並不是說，你應該完全忽略 Self XSS。


如果你發現了一個場景，其中 Self XSS 可以執行，但是不會儲存，你需要考慮該漏洞是否可以利用，是否有些東西可以結合起來，使其不再是 Self XSS？

最著名的 XSS 利用示例之一，就是 Samy Kamkar 執行的 MySpace Samy 蠕蟲。在 2005 年 10 月，Samy 利用了一個 MySpace 上的儲存型 XSS 漏洞，允許它上傳 JavaScript 腳本。這個程式碼隨後在任何人瀏覽它的 MySpace 主頁時執行，因此使任何 Samy 用戶資料的瀏覽者成為其好友。但是，更多的是，這個程式碼也複製其自身到Samy 新朋友的頁面，所以受感染頁面的瀏覽者使用下面這段話更新了它們的資料頁面：“but most of all, samy is my hero” （最重要的是，Samy 是我的英雄）。

雖然 Samy 的利用並不完全是惡意的，XSS 利用使其能夠盜取用戶、密碼、銀行訊息以及其他。雖然具有潛在的影響，修復 XSS 漏洞通常很簡單，只需要軟件開發者在渲染時轉義用戶輸入（就像 HTML 注入那樣）。在攻擊者提交它們的時候，一些站點也會截斷可能的惡意字符。

>連結
>
>查看 [OWASP XSS 過濾器繞過速查表。](https://www.owasp.org/index.php/XSS_Filter_Evasion_Cheat_Sheet)

---

## **示例**

## **1. Shopify Wholesale**


```
難度：低

URL：wholesale.shopify.com

報告鏈接：https://hackerone.com/reports/106293

報告日期：2015.12.21

獎金：$500

```

描述：

Shopify Wholesale 站點是一個簡單的頁面，擁有不同的操作調用 -- 輸入商品名稱並且點擊"搜索商品"，這裡是截圖：

![1](https://raw.githubusercontent.com/dyeat/Document_read/master/Web_Hacking_101/image/10-1.jpg)

Shopify Wholesale 站點截圖

這裡的 XSS 漏洞是你可以找到的最基本的漏洞 - 輸入到搜索框中的文本並沒有轉移，所以任何輸入的 JavaScript 都會執行。這裡是漏洞披露中的提交文本：`test';alert('XSS');'`。
<p>
它生效的原因是，Shopify 接收用戶輸入，執行搜索查詢，當沒有結果返回時，Shopify 會打印一條消息，說該名稱下沒有找到任何商品，之後重新打印出用戶輸入，而沒有任何轉義。因此，提交的 JavaScript 打印到了頁面上，瀏覽器將其解釋為 JavaScript 並執行。

>重要結論
>
>測試任何東西，特別要關註一些場景，其中你所輸入的文本渲染給了你。測試來判斷你是否可以包含 HTML 或者 
>JavaScript，來觀察站點如何處理它。同時嘗試編碼輸入，就像在 HTML 注入一章中描述的那樣。
>
>XSS 漏洞並不需要很複雜。這個漏洞是你能找到的最基本的東西 - 一個簡單的輸入文本字段，這個漏洞並不處理用戶輸入。
>它在 2015 年 12 月 21 日發現，並獲得了 $500 的獎金。它所需要的所有東西，就是黑客的思維。

