## **0x05 上傳**

---
<pre>
	這個上傳就大概說說。
一般的上傳漏洞可能是未驗證上傳後綴 或者是驗證上傳後綴被bypass 或者是上傳的文件驗證了上傳後綴但是文件名不重命名。
對於那些驗證了後綴但是文件名不重命名的
一般可以試試截斷yu.php%00.jpg 當然%00 要urldecode
當然 畢竟截斷雞肋了。上面提到過限制條件了。
還可以是結合各種webserver的解析漏洞
例如iis6的 xx.asp/yu.jpg yu.php;.jpg yu.asp;.jpg aspx 當然不能這樣解析了。
如果不重命名的就上傳這樣就行了。
Nginx的低版本解析漏洞: yu.jpg/1.php 對於這種直接上傳一個xxxx.jpg 再在這後面加上各種/.php 試試的
Apache解析漏洞 yu.php.xxx 在最後一個後綴識別不出來的時候 那麼就向上解析
最終解析成.php
像phpweb後台那個上傳漏洞。很多人遇到apache的時候
無法截斷的時候就上傳一個yu.php.jpg 有些人比較疑問的是為啥有時候成功有時候失敗。
這個主要是看os 像windows的話 .jpg 就直接是圖片了
所以在windows下 就直接識別成圖片了 而不是.php
而在linux下 .jpg不被識別 就向上識別成.php
這些解析漏洞在上傳中也挺經常遇到的。
上傳的驗證一般是 MIME、客戶端的JS驗證、白名單、黑名單。
前面兩種都比較簡單。
白名單就是允許用戶上傳哪些後綴的。黑名單就是禁止用戶上傳哪些後綴的。
這兩種相比來說一般是黑名單容易bypass一點。黑名單的繞過還是得具體看他黑名單的代碼。有的直接大小寫就過。有些沒對文件名trim的 直接在文件名後面加空格。 Windows下的 文件名後%81-%99 decode後的 或者是windows下的特性 .php::$data 這樣上傳上去依舊是.php
其實上傳還挺重要的。 。但是我又不知道說哪些。還是具體看代碼把。
</pre>

## **任意文件操作**
---
<pre>
這個主要是涉及到的是 任意文件刪除 任意文件複製 任意文件重命名 任意文件移動 任意文件下載……。因為像現在的cms很多都自帶得有加密 解密 函數 例如qibocms的mymd5 Dz的authcode 啥的。對於這些任意文件操作的首先可以試試拿到配置文件中的數據庫的連接帳號和密碼嘗試外聯一下但是很多時候都是只允許本地連的很多時候不好利用的時候可以利用拿到配置文件然後拿到這些函數的key 然後自己生成一個加密的字符串然後再結合具體的代碼進行最大化的利用。
</pre>

## **對於任意文件刪除**

---
<pre>
一般是挺不好利用的，還是結合具體的場景，有些因為全局的過濾而不能注入的，可以嘗試用任意文件刪除，刪掉這個文件，再進行注入一般的利用還是通過刪除安裝文件生成的lock文件，然後達到重裝。
不過這樣弊很大。
</pre>

## **任意文件複製 / 任意文件移動 / 任意文件重命名**
---
<pre>

複製的話 肯定涉及到了 要復制的文件 要復製到的路徑。
如果是要復制的文件可控 要復製到的路徑不可控的話 例如qibocms之前的一個洞
```
copy(ROOT_PATH."$webdb[updir]/$value",ROOT_PATH."$webdb[updir]/{$value}.jpg");
```
這裡$value 是可控的 但是又不能截斷 複製到的路徑限制了.jpg結尾。
這時候我們就可以把$value控制為 保存了qibocms的加密函數的key的配置文件
然後復制後 成了一個.jpg 那我們就可以直接打開 看到key了
例子: WooYun: Qibocms圖片系統任意文件查看導致的多處注入(可提升自己為管理員)

如果兩個都完全可控的話 那肯定是直接把自己的圖片複製成一個.php馬兒了。
</pre>

## **任意文件下載**

---

<pre>
其實跟上面複製差不多， 很多時候也是通過下載配置文件 拿到key。再進行各種操作。 。
例子: WooYun: qibocmsV7整站系統任意文件下載導致無限制注入多處(可提升自己為管理 Demo演示)
這個例子還涉及到了一個win的特性bypass 黑名單
</pre>